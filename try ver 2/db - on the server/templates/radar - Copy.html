<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Display with Movable Circle</title>
    <style>
        /* Set the SVG to fill the entire viewport */
        svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <svg id="map-svg" viewBox="0 0 1024 1024">
        <!-- Replace the following with your actual map image -->
        <image id="map-image" href="radars/de_dust2.png" width="100%" height="100%" />

        <!-- Create a separate layer for the circle -->
        <g id="circle-layer">
            <circle id="map-circle" fill="rgba(255, 0, 0, 0.5)" cx="400" cy="300" r="10" />
        </g>
    </svg>

    <script>
        // Function to update circle position based on mouse/touch events
        function moveCircle(evt) {
            var circle = document.getElementById('map-circle');
            var svg = document.getElementById('map-svg');

            // Get SVG viewBox dimensions
            var viewBox = svg.viewBox.baseVal;
            var viewBoxWidth = viewBox.width;
            var viewBoxHeight = viewBox.height;

            // Calculate mouse/touch coordinates relative to SVG
            var point = svg.createSVGPoint();
            point.x = evt.clientX || evt.touches[0].clientX;
            point.y = evt.clientY || evt.touches[0].clientY;
	    console.log(point.x)
            var svgPoint = point.matrixTransform(svg.getScreenCTM().inverse());

            // Ensure circle stays within SVG boundaries
            var cx = Math.max(Math.min(svgPoint.x, viewBoxWidth), 0);
            var cy = Math.max(Math.min(svgPoint.y, viewBoxHeight), 0);
		

            // Update circle position
            circle.setAttribute('cx', cx);
            circle.setAttribute('cy', cy);
        }

        // Event listeners for mouse and touch events
        function setupListeners() {
            var circle = document.getElementById('map-circle');

            circle.addEventListener('mousedown', startMove);
            circle.addEventListener('touchstart', startMove);

            function startMove(evt) {
                evt.preventDefault();
                window.addEventListener('mousemove', moveCircle);
                window.addEventListener('touchmove', moveCircle);
                window.addEventListener('mouseup', endMove);
                window.addEventListener('touchend', endMove);
            }

            function endMove(evt) {
                window.removeEventListener('mousemove', moveCircle);
                window.removeEventListener('touchmove', moveCircle);
                window.removeEventListener('mouseup', endMove);
                window.removeEventListener('touchend', endMove);
            }
        }

        // Call setupListeners() to initialize circle movement
        setupListeners();

        // Function to update circle size based on map dimensions
        function updateCircleSize() {
            var mapImage = document.getElementById('map-image');
            var mapWidth = mapImage.naturalWidth; // Get the natural width of the image

            // Calculate scale factor for the circle radius
            var scaleX = mapImage.getBoundingClientRect().width / mapWidth;

            // Ensure mapWidth is valid and greater than 0 to prevent NaN in circleRadius
            if (mapWidth > 0) {
                // Update circle radius based on map width
                var circle = document.getElementById('map-circle');
                var circleRadius = mapWidth * 0.02; // Adjust this multiplier as needed
                circle.setAttribute('r', circleRadius * scaleX);
            }
        }

        // Call the function initially and whenever the window resizes
        window.addEventListener('DOMContentLoaded', updateCircleSize);
        window.addEventListener('resize', updateCircleSize);
    </script>
</body>
</html>
